# 아이템 76. 가능한 한 실패 원자적으로 만들라

## 실패 원자적 (failure-atomic)

- 호출된 메서드가 실패하더라도 해당 객체는 메서드 호출 전 상태를 유지해야된다.

<br/>

## 실패 원자적으로 만드는 방법

<br/>

#### 1) 불변 객체로 설계 (아이템 17)

- 불변객체 상태는 절대 변하지 않기 때문에 실패 원자적이다.

<br/>

#### 2) 작업 수행에 앞서 매개변수의 유효성을 검사 (아이템 49)

```java
public Object pop(){
    if (size == 0)
        throw new EmptyStackException();
    Object result = elements[--size];
    elements[size] = null;
    return result;
}
```

- `EmptyStackException`을 제거한다면?
    - 물론 제거하더라도 예외를 던지지만, size 값이 음수가 되어 다음번 호출도 실패하게 된다. 이때 `OutOfBoundsException`을 던지는데 추상화 수준이 상황에 어울리지 않음

> - 만약 계산해보기 전에는 인수의 유효성 검증해볼 수 없다면?
    >
- 실패할 가능성이 있는 모든 코드를, 객체의 상태를 바꾸는 코드보다 앞에 배치하는 방법도 있음

<br/>

#### 3) 객체의 임시 복사본에서 작업을 수행한다음, 작업이 성공적으로 완료되면 원래 객체와 교체

- 특히 데이터를 임시 자료구조에 저장해 작업하는게 더 빠를 때 적용하기 좋음

<br/>

#### 4) 작업 도중 발생하는 실패를 가로채는 복구 코드를 작성하여 작업 전 상태로 되돌리는 방법

- 주로 (디스크 기반) 내구성을 보장해야하는 자료구조에 쓰임
- 자주 쓰이지는 않음

<br/>